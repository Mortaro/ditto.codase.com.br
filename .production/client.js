!function(t){var e={};function __webpack_require__(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}__webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,i){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)__webpack_require__.d(i,n,function(e){return t[e]}.bind(null,n));return i},__webpack_require__.n=function(t){var e=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=2)}([function(t,e,i){},function(t,e,i){},function(t,e,i){"use strict";i.r(e);i(0),i(1);const n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*))(?:Z|(\+|-)([\d|:]*))?$/,r=/^\/Date\((d|-|.*)\)[\/|\\]$/;function dateParser(t,e){if("string"==typeof e){let t=n.exec(e);if(t)return new Date(e);if(t=r.exec(e),t){const e=t[1].split(/[-+,.]/);return new Date(e[0]?+e[0]:0-+e[1])}}return e}function deserialize(t){return JSON.parse(t,dateParser)}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}window.representation=deserialize(JSON.stringify(window.representation)),window.instances=deserialize(JSON.stringify(window.instances)),window.addEventListener("popstate",()=>{Nullstack.update()});const s={set(t,e,i){"title"===e&&(document.title=i);const n=Reflect.set(...arguments);return Nullstack.update(),n}};const a={...window.environment,client:!0,server:!1};delete window.environment;const o=new Proxy({...window.metadata},s);delete window.metadata;const c=new class Router{set url(t){history.pushState({},document.title,t),window.dispatchEvent(new Event("popstate")),Nullstack.routeChanged=!0}get url(){return window.location.pathname+window.location.search}},u={environment:a,metadata:o,router:c},l={set(t,e,i){return u[e]=i,Nullstack.update(),Reflect.set(...arguments)}},h={get(t,e){if("initialize"!==e&&"initiate"!==e&&void 0===t[e]&&!0===t.constructor[e]){const detour=async function(i={}){const n=`/${t.constructor.name}/${e}.json`,r=await fetch(n,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(i)});return deserialize(await r.text()).result};t[e]=detour.bind(this)}return Reflect.get(...arguments)},set(t,e,i){const n=Reflect.set(...arguments);return Nullstack.update(),n}};class Nullstack{static initialize(){const t=this;Nullstack.start(()=>Nullstack.element(t,null))}render(){return!1}static start(t,e="#application"){for(const[t,e]of Object.entries(window.context))u[t]=e;delete window.context,this.routes={},this.currentInstance=null,this.initializer=t,this.selector=document.querySelector(e),this.instancesMountedQueue=[],this.instancesRenewedQueue=[],this.virtualDom=window.representation,this.nextVirtualDom=this.initializer(),this.rerender(this.selector,[0],[]),this.virtualDom=this.nextVirtualDom,this.nextVirtualDom=null,delete window.representation,delete window.instances,this.processLifecycleQueues()}static generateKey(t,e){return e.join(".")}static generateContext(t){return new Proxy({...u,...t},l)}static getQueryStringParams(t){return t?(t=/^[?#]/.test(t)?t.slice(1):t).split("&").reduce((t,e)=>{let[i,n]=e.split("=");return t[i]=this.extractParamValue(n),t},{}):{}}static extractParamValue(t){return"true"===t||"false"!==t&&(/^\d+$/.test(t)?parseInt(t):t?decodeURIComponent(t.replace(/\+/g," ")):"")}static routeMatches(t,e){let[i,n]=t.split("?");if("*"===e)return this.getQueryStringParams(n);const r=i.split("/"),s=e.split("/");if(s.length!=r.length)return!1;const a={};for(let t=0;t<s.length;t++)if(s[t].startsWith(":")){a[s[t].replace(":","")]=this.extractParamValue(r[t])}else if(s[t]!==r[t])return!1;return{...a,...this.getQueryStringParams(n)}}static findParentInstance(t){for(let e=0;e<t.length;e++){const i=t.slice(0,-1*e).join(".");if(this.instances[i])return this.instances[i]}}static rerender(t,e,i){if(!this.hydrated)for(const e of t.childNodes)8===e.COMMENT_NODE&&"#"===e.textContent&&t.removeChild(e);const n=e[e.length-1],r=t.childNodes[n];let s=this.virtualDom,a=this.nextVirtualDom;for(const t of i)s=s.children[t],a=a.children[t];if(!this.isFalse(s)||!this.isFalse(a)){if((this.isFalse(s)||this.isFalse(a))&&s!=a){const e=this.render(a,i);return t.replaceChild(e,r)}if(this.isFunction(a)){const n=this.findParentInstance([0,...i]),r=this.generateContext({...n.attributes,...a.attributes}),s=a.type(r);return a.children=[s],this.rerender(t,e,[...i,0])}if(void 0!==s&&/^[A-Z]/.test(s.type)&&"function"==typeof a.type&&s.type===a.type.name){const n=this.generateKey(a,[0,...i]),r=new a.type;r.events={},this.instances[n]=r;const o=window.instances[n];for(const t in o)r[t]=o[t];this.instancesMountedQueue.push(r);const c=this.generateContext(a.attributes);r.initialize&&r.initialize(c),r.attributes=a.attributes,this.instancesRenewedQueue.push(r);const u=r.render(c);a.children=[u];const l=Math.max(s.children.length,a.children.length);for(let n=0;n<l;n++)this.rerender(t,e,[...i,n])}else if(this.isClass(s)&&s.type===a.type){const n=this.generateKey(a,[0,...i]);let r=null;a.attributes.params&&this.routeChanged||(r=this.instances[n]);const o=this.generateContext(a.attributes);r||(r=new a.type,r.events={},this.instances[n]=r,this.instancesMountedQueue.push(r),r.initialize&&r.initialize(o)),r.attributes=a.attributes,this.instancesRenewedQueue.push(r);const c=r.render(o);a.children=[c];const u=Math.max(s.children.length,a.children.length);for(let n=0;n<u;n++)this.rerender(t,e,[...i,n])}else if(s.type!==a.type){const e=this.render(a,i);t.replaceChild(e,r)}else if(this.isText(s)&&this.isText(a)){if(s!=a)return r.nodeValue=a}else if(s.type===a.type){if("a"===a.type&&a.attributes.href&&a.attributes.href.startsWith("/")&&(a.attributes.onclick=({event:t})=>{t.preventDefault(),c.url=a.attributes.href,u.environment.prerendered=!1}),a.attributes.bind){const t=this.findParentInstance([0,...i]);"textarea"===a.type?a.children=[t[a.attributes.bind]]:"input"===a.type&&"checkbox"===a.attributes.type?a.attributes.checked=t[a.attributes.bind]:a.attributes.value=t[a.attributes.bind],a.attributes.name=a.attributes.bind;let e="oninput",n="value";"checkbox"===a.attributes.type||"radio"===a.attributes.type?(e="onclick",n="checked"):"input"!==a.type&&"textarea"!==a.type&&(e="onchange"),a.attributes[e]=({event:e})=>{t[a.attributes.bind]=e.target[n]}}const t=Object.keys({...s.attributes,...a.attributes});for(const e of t)if("html"===e){a.attributes[e]!==s.attributes[e]&&(r.innerHTML=a.attributes[e]);const t=r.querySelectorAll('a[href^="/"]');for(const e of t)e.onclick=t=>{t.preventDefault(),c.url=e.href,u.environment.prerendered=!1}}else if("checked"===e)a.attributes[e]!==r.value&&(r.checked=a.attributes[e]);else if("value"===e)a.attributes[e]!==r.value&&(r.value=a.attributes[e]);else if(e.startsWith("on")){const t=e.replace("on",""),n="0."+i.join(".")+"."+t,s=this.findParentInstance([0,...i]);r.removeEventListener(t,s.events[n]),a.attributes[e]?(s.events[n]=t=>{!0!==a.attributes.default&&t.preventDefault();const i=this.generateContext({...s.attributes,...a.attributes,event:t});a.attributes[e](i)},r.addEventListener(t,s.events[n])):delete s.events[n]}else"function"!=typeof a.attributes[e]&&"object"!=typeof a.attributes[e]&&(void 0===s.attributes[e]&&void 0!==a.attributes[e]?r.setAttribute(e,a.attributes[e]):void 0!==s.attributes[e]&&void 0===a.attributes[e]?r.removeAttribute(e):s.attributes[e]!==a.attributes[e]&&(!1===a.attributes[e]||null===a.attributes[e]||void 0===a.attributes[e]?r.removeAttribute(e):!0===a.attributes[e]?r.setAttribute(e,e):r.setAttribute(e,a.attributes[e])));if(a.attributes.html)return;const n=Math.max(s.children.length,a.children.length),o=e.join(".");for(const t of a.children)if(this.isRoutable(t)){if(void 0!==this.routes[o])t.type=!1,t.children=[];else{const e=this.routeMatches(c.url,t.attributes.route);e?(this.routes[o]=!0,t.attributes.params=e):(t.type=!1,t.children=[])}delete t.attributes.route}if(a.children.length>s.children.length){for(let t=0;t<s.children.length;t++)this.rerender(r,[...e,t],[...i,t]);for(let t=s.children.length;t<a.children.length;t++){const e=this.render(a.children[t],[...i,t]);r.appendChild(e)}}else if(s.children.length>a.children.length){for(let t=0;t<a.children.length;t++)this.rerender(r,[...e,t],[...i,t]);for(let t=s.children.length-1;t>=a.children.length;t--)r.removeChild(r.childNodes[t])}else for(let t=n-1;t>-1;t--)this.rerender(r,[...e,t],[...i,t])}}}static update(){this.initialized&&(clearInterval(this.renderQueue),this.renderQueue=setTimeout(()=>{this.initialized=!1,this.routes={},this.instancesMountedQueue=[],this.instancesRenewedQueue=[],this.nextVirtualDom=this.initializer(),this.rerender(this.selector,[0],[]),this.virtualDom=this.nextVirtualDom,this.nextVirtualDom=null,this.processLifecycleQueues()},16))}static async processLifecycleQueues(){this.initialized||(this.initialized=!0,this.hydrated=!0);for(const t of this.instancesMountedQueue){const e=this.generateContext(t.attributes);t.initiate&&await t.initiate(e)}for(const[t,e]of Object.entries(this.instances))if(!this.instancesRenewedQueue.includes(e)){const i=this.generateContext(e.attributes);e.terminate&&await e.terminate(i),delete this.instances[t]}this.routeChanged=!1}constructor(){_defineProperty(this,"routeChanged",!1);const t=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),e=new Proxy(this,h);for(const i of t)"constructor"!==i&&"function"==typeof this[i]&&(this[i]=this[i].bind(e));return e}static flattenChildren(t){return t=[].concat.apply([],t).map(t=>null!=t&&("Fragment"===t.type?this.flattenChildren(t.children):t)),[].concat.apply([],t)}static element(t,e={},...i){return null===e&&(e={}),i=this.flattenChildren(i),"textarea"===t&&(i=[i.join("")]),"function"==typeof t&&void 0!==t.render?{type:t,attributes:e,children:[]}:{type:t,attributes:e,children:i}}static isFalse(t){return!1===t||!1===t.type}static isBlank(t){return null==t}static isRoutable(t){return t&&void 0!==t.attributes&&void 0!==t.attributes.route}static isClass(t){return"function"==typeof t.type&&typeof("function"===t.type.prototype.render)}static isFunction(t){return"function"==typeof t.type&&void 0===t.type.prototype}static isText(t){return"Fragment"!==t&&void 0===t.children}static render(t,e){if(this.isRoutable(t)){const i=e.slice(0,-1).join(".");void 0!==this.routes[i]&&(t.type=!1,t.children=[]);const n=this.routeMatches(c.url,t.attributes.route);n?(this.routes[i]=!0,t.attributes.params=n):(t.type=!1,t.children=[])}if(this.isFalse(t))return document.createComment("");if(this.isFunction(t)){const i=this.findParentInstance([0,...e]),n=this.generateContext({...i.attributes,...t.attributes}),r=t.type(n);return t.children=[r],this.render(t.children[0],[...e,0])}if(this.isClass(t)){const i=this.generateKey(t,[0,...e]),n=new t.type;n.events={},n.attributes=t.attributes,this.instances[i]=n;const r=this.generateContext(t.attributes);n.initialize&&n.initialize(r);const s=n.render(r);return t.children=[s],this.instancesMountedQueue.push(n),this.instancesRenewedQueue.push(n),this.render(t.children[0],[...e,0])}if(this.isText(t))return document.createTextNode(t);let i,n=this.nextVirtualDom,r=!1;for(const t of e){if(n=n.children[t],!n)break;if("svg"===n.type){r=!0;break}}if(i=r?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type),"a"===t.type&&t.attributes.href&&t.attributes.href.startsWith("/")&&(t.attributes.onclick=({event:e})=>{e.preventDefault(),c.url=t.attributes.href,u.environment.prerendered=!1}),t.attributes.bind){const i=this.findParentInstance([0,...e]);"textarea"===t.type?t.children=[i[t.attributes.bind]]:t.attributes.value=i[t.attributes.bind],t.attributes.name=t.attributes.bind;let n="oninput",r="value";"checkbox"===t.attributes.type||"radio"===t.attributes.type?(n="onclick",r="checked"):"input"!==t.type&&"textarea"!==t.type&&(n="onchange"),t.attributes[n]=({event:e})=>{i[t.attributes.bind]=e.target[r]}}for(let n in t.attributes)if("html"===n){i.innerHTML=t.attributes[n];const e=i.querySelectorAll('a[href^="/"]');for(const t of e)t.onclick=e=>{e.preventDefault(),c.url=t.href,u.environment.prerendered=!1}}else if(n.startsWith("on")){const r=n.replace("on",""),s="0."+e.join(".")+"."+r,a=this.findParentInstance([0,...e]);a.events[s]=e=>{!0!==t.attributes.default&&e.preventDefault();const i=this.generateContext({...a.attributes,...t.attributes,event:e});t.attributes[n](i)},i.addEventListener(r,a.events[s])}else"function"!=typeof t.attributes[n]&&"object"!=typeof t.attributes[n]&&(!0===t.attributes[n]?i.setAttribute(n,n):!1!==t.attributes[n]&&null!==t.attributes[n]&&void 0!==t.attributes[n]&&i.setAttribute(n,t.attributes[n]));if(!t.attributes.html)for(let n=0;n<t.children.length;n++){const r=this.render(t.children[n],[...e,n]);i.appendChild(r)}return i}}_defineProperty(Nullstack,"initialized",!1),_defineProperty(Nullstack,"hydrated",!1),_defineProperty(Nullstack,"initializer",null),_defineProperty(Nullstack,"instances",{}),_defineProperty(Nullstack,"instancesMountedQueue",[]),_defineProperty(Nullstack,"instancesRenewedQueue",[]),_defineProperty(Nullstack,"virtualDom",{}),_defineProperty(Nullstack,"selector",null),_defineProperty(Nullstack,"routes",{}),_defineProperty(Nullstack,"renderQueue",null);var d=Nullstack;function Application_defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Application_Application extends d{constructor(...t){super(...t),Application_defineProperty(this,"room",""),Application_defineProperty(this,"command",""),Application_defineProperty(this,"socket",null),Application_defineProperty(this,"shortcuts",[]),Application_defineProperty(this,"executing",!1)}initiate({environment:t,metadata:e}){e.title="Ditto Server",t.client&&(this.connect(),localStorage.shortcuts&&(this.shortcuts=JSON.parse(localStorage.shortcuts)))}connect(){this.socket=new WebSocket("ws://"+location.host,"protocolOne"),this.socket.onclose=()=>setTimeout(this.connect,1e3),this.socket.onerror=()=>this.socket.close()}remove({shortcut:t}){this.shortcuts=this.shortcuts.filter(e=>e!=t),localStorage.shortcuts=JSON.stringify(this.shortcuts)}execute({shortcut:t}){if(!this.executing){if(!t){if(!this.room||!this.command)return;t=this.room+" "+this.command}this.socket.send(t),this.shortcuts.includes(t)||(this.shortcuts.push(t),localStorage.shortcuts=JSON.stringify(this.shortcuts)),this.room="",this.command="",this.executing=!0,setTimeout(()=>this.executing=!1,500)}}renderShortcut({shortcut:t}){return d.element("div",{class:"xl m2b bg1 p4x p2y"},d.element("div",{class:"xl x6 yy"}," ",t," "),d.element("div",{class:"xr x6 yy"},d.element("button",{class:"xx x0 c0 bg3 p2x p1y m1r",onclick:this.remove,shortcut:t,disabled:this.executing}," x "),d.element("button",{class:"xx x0 c0 bg3 p2x p1y",onclick:this.execute,shortcut:t,disabled:this.executing}," Execute ")))}render({metadata:t}){const e=this.renderShortcut;return d.element("main",{class:"xx bg1"},d.element("div",{class:"xxx yy y12 p4x"},d.element("form",{class:"xx bg0 md+x6 s1",onsubmit:this.execute},d.element("h1",{class:"xx p3y bc1b c3"}," ",t.title," "),d.element("div",{class:"xx p4"},d.element("input",{bind:"room",placeholder:"room",class:"bc1 p4 m2b"}),d.element("input",{bind:"command",placeholder:"command",class:"bc1 p4 m2b"}),d.element("button",{class:"xx bg3 c0 p4",disabled:this.executing}," Execute ")),this.shortcuts.length>0&&d.element("div",{class:"xx p4x p4t p2b bc1t"},this.shortcuts.map(t=>d.element(e,{shortcut:t}))))))}}Application_defineProperty(Application_Application,"initiate",!0),Application_Application.initialize()}]);