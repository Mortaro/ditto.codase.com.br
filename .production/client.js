!function(t){var e={};function __webpack_require__(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}__webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,i){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)__webpack_require__.d(i,r,function(e){return t[e]}.bind(null,r));return i},__webpack_require__.n=function(t){var e=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=2)}([function(t,e,i){},function(t,e,i){},function(t,e,i){"use strict";i.r(e);i(0);const r=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*))(?:Z|(\+|-)([\d|:]*))?$/,s=/^\/Date\((d|-|.*)\)[\/|\\]$/;function dateParser(t,e){if("string"==typeof e){let t=r.exec(e);if(t)return new Date(e);if(t=s.exec(e),t){const e=t[1].split(/[-+,.]/);return new Date(e[0]?+e[0]:0-+e[1])}}return e}function deserialize(t){return JSON.parse(t,dateParser)}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}window.representation=deserialize(JSON.stringify(window.representation)),window.instances=deserialize(JSON.stringify(window.instances)),window.addEventListener("popstate",()=>{Nullstack.update()});const n={set(t,e,i){"title"===e&&(document.title=i);const r=Reflect.set(...arguments);return Nullstack.update(),r}};const a={...window.environment,client:!0,server:!1};delete window.environment;const o=new Proxy({...window.page},n);delete window.page;const u=new class Router{set url(t){history.pushState({},document.title,t),window.dispatchEvent(new Event("popstate")),Nullstack.routeChanged=!0}get url(){return window.location.pathname+window.location.search}},c={environment:a,page:o,router:u},l={set(t,e,i){return c[e]=i,Nullstack.update(),Reflect.set(...arguments)}},d={get(t,e){if(t.attributes&&t.attributes.proxy&&void 0!==t.attributes.proxy[e]&&void 0!==t[e])return t.attributes.proxy[e];if("prepare"!==e&&"initiate"!==e&&void 0===t[e]&&!0===t.constructor[e]){const detour=async function(i={}){const r=`/${t.constructor.hash}/${e}.json`,s=await fetch(r,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(i)});return deserialize(await s.text()).result};t[e]=detour.bind(this)}return Reflect.get(...arguments)},set(t,e,i){t.attributes&&t.attributes.proxy&&void 0!==t.attributes.proxy[e]&&void 0!==t[e]&&(t.attributes.proxy[e]=i);const r=Reflect.set(...arguments);return Nullstack.update(),r}};class Nullstack{render(){return!1}static start(t){for(const[t,e]of Object.entries(window.context))c[t]=e;Object.freeze(c.project),delete window.context,this.routes={};const[e,i]=u.url.split("?");this.params=this.getQueryStringParams(i),this.currentInstance=null,this.initializer=()=>Nullstack.element(t),this.selector=document.querySelector("#application"),this.instancesMountedQueue=[],this.instancesRenewedQueue=[],this.virtualDom=window.representation,this.nextVirtualDom=this.initializer(),this.rerender(this.selector,[0],[]),this.virtualDom=this.nextVirtualDom,this.nextVirtualDom=null,delete window.representation,delete window.instances,this.processLifecycleQueues()}static generateKey(t,e){return e.join(".")}static generateContext(t){return t.params=t.params?{...this.params,...t.params}:this.params,new Proxy({...c,...t},l)}static getQueryStringParams(t){return t?(t=/^[?#]/.test(t)?t.slice(1):t).split("&").reduce((t,e)=>{let[i,r]=e.split("=");return t[i]=this.extractParamValue(r),t},{}):{}}static extractParamValue(t){return"true"===t||"false"!==t&&(t?decodeURIComponent(t.replace(/\+/g," ")):"")}static routeMatches(t,e){let[i,r]=t.split("?");const s=i.split("/"),n=e.split("/"),a={},o=Math.max(s.length,n.length);let u=!1;for(let t=0;t<o;t++)if(!u)if("*"===n[t])u=!0;else if(n[t]&&n[t].startsWith(":")){a[n[t].replace(":","")]=this.extractParamValue(s[t])}else if(n[t]!==s[t])return!1;return a}static findParentInstance(t){for(let e=0;e<t.length;e++){const i=t.slice(0,-1*e).join(".");if(this.instances[i])return this.instances[i]}}static rerender(t,e,i){if(!this.hydrated)for(const e of t.childNodes)e.tagName&&"textarea"==e.tagName.toLowerCase()&&0==e.childNodes.length&&e.appendChild(document.createTextNode("")),8===e.COMMENT_NODE&&"#"===e.textContent&&t.removeChild(e);const r=e[e.length-1],s=t.childNodes[r];let n=this.virtualDom,a=this.nextVirtualDom;for(const t of i)n=n.children[t],a=a.children[t];if(!this.isFalse(n)||!this.isFalse(a)){if((this.isFalse(n)||this.isFalse(a))&&n!=a){const e=this.render(a,i);return t.replaceChild(e,s)}if(void 0!==a&&void 0!==a.attributes&&a.attributes.bind){const t=this.findParentInstance([0,...i]),e=a.attributes.source||t;"textarea"===a.type?a.children=[e[a.attributes.bind]]:"input"===a.type&&"checkbox"===a.attributes.type?a.attributes.checked=e[a.attributes.bind]:a.attributes.value=e[a.attributes.bind],a.attributes.name=a.attributes.bind;let r="oninput",s="value";"checkbox"===a.attributes.type||"radio"===a.attributes.type?(r="onclick",s="checked"):"input"!==a.type&&"textarea"!==a.type&&(r="onchange");const n=a.attributes[r];a.attributes[r]=({event:i,value:r})=>{if(!0===e[a.attributes.bind]||!1===e[a.attributes.bind]?e[a.attributes.bind]=i?"true"==i.target[s]:r:"number"==typeof e[a.attributes.bind]?e[a.attributes.bind]=parseFloat(i?i.target[s]:r)||0:e[a.attributes.bind]=i?i.target[s]:r,Nullstack.update(),void 0!==n){const e=this.generateContext({...t.attributes,...a.attributes,event:i,value:r});n(e)}}}if(this.isFunction(a)){const r=this.findParentInstance([0,...i]),s=this.generateContext({...r.attributes,...a.attributes}),n=a.type(s);return a.children=[n],this.rerender(t,e,[...i,0])}if(void 0!==n&&/^[A-Z]/.test(n.type)&&"function"==typeof a.type&&n.type===a.type.name){const r=this.generateKey(a,[0,...i]),s=new a.type;s.events={},this.instances[r]=s;const o=window.instances[r];for(const t in o)s[t]=o[t];this.instancesMountedQueue.push(s);const u=this.generateContext(a.attributes);s.prepare&&s.prepare(u),s.attributes=a.attributes,this.instancesRenewedQueue.push(s);const c=s.render(u);a.children=[c];const l=Math.max(n.children.length,a.children.length);for(let r=0;r<l;r++)this.rerender(t,e,[...i,r])}else if(this.isClass(n)&&n.type===a.type){const r=this.generateKey(a,[0,...i]);let s=null;if(this.routeChanged){if(this.routeChanged){let t=!1;if(a.attributes._segments){for(const e of a.attributes._segments)n.attributes.params[e]!==a.attributes.params[e]&&(t=!0);delete a.attributes._segments}t||(s=this.instances[r])}}else s=this.instances[r];const o=this.generateContext(a.attributes);s||(s=new a.type,s.events={},this.instances[r]=s,this.instancesMountedQueue.push(s),s.prepare&&s.prepare(o)),s.attributes=a.attributes,this.instancesRenewedQueue.push(s);const u=s.render(o);a.children=[u];const c=Math.max(n.children.length,a.children.length);for(let r=0;r<c;r++)this.rerender(t,e,[...i,r])}else if(n.type!==a.type){const e=this.render(a,i);t.replaceChild(e,s)}else if(this.isText(n)&&this.isText(a)){if(n!=a)return s.nodeValue=a}else if(n.type===a.type){"a"===a.type&&a.attributes.href&&a.attributes.href.startsWith("/")&&!a.attributes.target&&(a.attributes.onclick=({event:t})=>{t.preventDefault(),u.url=a.attributes.href,c.environment.prerendered=!1});const t=Object.keys({...n.attributes,...a.attributes});for(const e of t)if("html"===e){a.attributes[e]!==n.attributes[e]&&(s.innerHTML=a.attributes[e]);const t=s.querySelectorAll('a[href^="/"]:not([target])');for(const e of t)e.onclick=t=>{t.preventDefault(),u.url=e.href,c.environment.prerendered=!1}}else if("checked"===e)a.attributes[e]!==s.value&&(s.checked=a.attributes[e]);else if("value"===e)a.attributes[e]!==s.value&&(s.value=a.attributes[e]);else if(e.startsWith("on")){const t=e.replace("on",""),r="0."+i.join(".")+"."+t,n=this.findParentInstance([0,...i]);s.removeEventListener(t,n.events[r]),a.attributes[e]?(n.events[r]=t=>{!0!==a.attributes.default&&t.preventDefault();const i=this.generateContext({...n.attributes,...a.attributes,event:t});a.attributes[e](i)},s.addEventListener(t,n.events[r])):delete n.events[r]}else"function"!=typeof a.attributes[e]&&"object"!=typeof a.attributes[e]&&(void 0===n.attributes[e]&&void 0!==a.attributes[e]?s.setAttribute(e,a.attributes[e]):void 0!==n.attributes[e]&&void 0===a.attributes[e]?s.removeAttribute(e):n.attributes[e]!==a.attributes[e]&&("value"!=e&&!1===a.attributes[e]||null===a.attributes[e]||void 0===a.attributes[e]?s.removeAttribute(e):"value"!=e&&!0===a.attributes[e]?s.setAttribute(e,e):s.setAttribute(e,a.attributes[e])));if(a.attributes.html)return;const r=Math.max(n.children.length,a.children.length),o=e.join(".");for(const t of a.children)if(this.isRoutable(t)){if(void 0!==this.routes[o])t.type=!1,t.children=[];else{const e=this.routeMatches(u.url,t.attributes.route);e?(this.routes[o]=!0,t.attributes.params=e):(t.type=!1,t.children=[])}t.attributes._segments=t.attributes.route.split("/").filter(t=>":"==t[0]).map(t=>t.slice(1)),delete t.attributes.route}if(a.children.length>n.children.length){for(let t=0;t<n.children.length;t++)this.rerender(s,[...e,t],[...i,t]);for(let t=n.children.length;t<a.children.length;t++){const e=this.render(a.children[t],[...i,t]);s.appendChild(e)}}else if(n.children.length>a.children.length){for(let t=0;t<a.children.length;t++)this.rerender(s,[...e,t],[...i,t]);for(let t=n.children.length-1;t>=a.children.length;t--)s.removeChild(s.childNodes[t])}else for(let t=r-1;t>-1;t--)this.rerender(s,[...e,t],[...i,t]);"textarea"==a.type&&(s.value=a.children.join("")),"select"==a.type&&(s.value=a.attributes.value)}}}static update(){this.initialized&&(clearInterval(this.renderQueue),this.renderQueue=setTimeout(()=>{const[t,e]=u.url.split("?");this.params=this.getQueryStringParams(e),this.initialized=!1,this.routes={},this.instancesMountedQueue=[],this.instancesRenewedQueue=[],this.nextVirtualDom=this.initializer(),this.rerender(this.selector,[0],[]),this.virtualDom=this.nextVirtualDom,this.nextVirtualDom=null,this.processLifecycleQueues()},16))}static async processLifecycleQueues(){this.initialized||(this.initialized=!0,this.hydrated=!0);for(const t of this.instancesMountedQueue){const e=this.generateContext(t.attributes);t.initiate&&await t.initiate(e)}for(const[t,e]of Object.entries(this.instances))if(!this.instancesRenewedQueue.includes(e)){const i=this.generateContext(e.attributes);e.terminate&&await e.terminate(i),delete this.instances[t]}this.routeChanged=!1}constructor(){_defineProperty(this,"routeChanged",!1);const t=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),e=new Proxy(this,d);for(const i of t)"constructor"!==i&&"function"==typeof this[i]&&(this[i]=this[i].bind(e));return e}static flattenChildren(t){return t=[].concat.apply([],t).map(t=>null!=t&&("Fragment"===t.type?this.flattenChildren(t.children):t)),[].concat.apply([],t)}static element(t,e={},...i){return null===e&&(e={}),i=this.flattenChildren(i),"textarea"===t&&(i=[i.join("")]),"function"==typeof t&&void 0!==t.render?{type:t,attributes:e,children:[]}:{type:t,attributes:e,children:i}}static isFalse(t){return!1===t||!1===t.type}static isBlank(t){return null==t}static isRoutable(t){return t&&void 0!==t.attributes&&void 0!==t.attributes.route}static isClass(t){return"function"==typeof t.type&&typeof("function"===t.type.prototype.render)}static isFunction(t){return"function"==typeof t.type&&void 0===t.type.prototype}static isText(t){return"Fragment"!==t&&void 0===t.children}static render(t,e){if(this.isRoutable(t)){const i=e.slice(0,-1).join(".");void 0!==this.routes[i]&&(t.type=!1,t.children=[]);const r=this.routeMatches(u.url,t.attributes.route);r?(this.routes[i]=!0,t.attributes.params=r):(t.type=!1,t.children=[])}if(this.isFalse(t))return document.createComment("");if(null!=t&&null!=t.attributes&&t.attributes.bind){const i=this.findParentInstance([0,...e]),r=t.attributes.source||i;"textarea"===t.type?t.children=[r[t.attributes.bind]]:t.attributes.value=r[t.attributes.bind],t.attributes.name=t.attributes.bind;let s="oninput",n="value";"checkbox"===t.attributes.type||"radio"===t.attributes.type?(s="onclick",n="checked"):"input"!==t.type&&"textarea"!==t.type&&(s="onchange");const a=t.attributes[s];t.attributes[s]=({event:e,value:s})=>{if(!0===r[t.attributes.bind]||!1===r[t.attributes.bind]?r[t.attributes.bind]=e?"true"==e.target[n]:s:"number"==typeof r[t.attributes.bind]?r[t.attributes.bind]=parseFloat(e?e.target[n]:s)||0:r[t.attributes.bind]=e?e.target[n]:s,r[t.attributes.bind]=e?e.target[n]:s,Nullstack.update(),void 0!==a){const r=this.generateContext({...i.attributes,...t.attributes,event:e,value:s});a(r)}}}if(this.isFunction(t)){const i=this.findParentInstance([0,...e]),r=this.generateContext({...i.attributes,...t.attributes}),s=t.type(r);return t.children=[s],this.render(t.children[0],[...e,0])}if(this.isClass(t)){const i=this.generateKey(t,[0,...e]),r=new t.type;r.events={},r.attributes=t.attributes,this.instances[i]=r;const s=this.generateContext(t.attributes);r.prepare&&r.prepare(s);const n=r.render(s);return t.children=[n],this.instancesMountedQueue.push(r),this.instancesRenewedQueue.push(r),this.render(t.children[0],[...e,0])}if(this.isText(t))return document.createTextNode(t);let i,r=this.nextVirtualDom,s=!1;for(const t of e){if(r=r.children[t],!r)break;if("svg"===r.type){s=!0;break}}i=s?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type),"a"===t.type&&t.attributes.href&&t.attributes.href.startsWith("/")&&!t.attributes.target&&(t.attributes.onclick=({event:e})=>{e.preventDefault(),u.url=t.attributes.href,c.environment.prerendered=!1});for(let r in t.attributes)if("html"===r){i.innerHTML=t.attributes[r];const e=i.querySelectorAll('a[href^="/"]:not([target])');for(const t of e)t.onclick=e=>{e.preventDefault(),u.url=t.href,c.environment.prerendered=!1}}else if(r.startsWith("on")){const s=r.replace("on",""),n="0."+e.join(".")+"."+s,a=this.findParentInstance([0,...e]);a.events[n]=e=>{!0!==t.attributes.default&&e.preventDefault();const i=this.generateContext({...a.attributes,...t.attributes,event:e});t.attributes[r](i)},i.addEventListener(s,a.events[n])}else"function"!=typeof t.attributes[r]&&"object"!=typeof t.attributes[r]&&("value"!=r&&!0===t.attributes[r]?i.setAttribute(r,r):("value"==r||!1!==t.attributes[r]&&null!==t.attributes[r]&&void 0!==t.attributes[r])&&i.setAttribute(r,t.attributes[r]));if(!t.attributes.html){for(let r=0;r<t.children.length;r++){const s=this.render(t.children[r],[...e,r]);i.appendChild(s)}"select"==t.type&&(i.value=t.attributes.value)}return i}}_defineProperty(Nullstack,"initialized",!1),_defineProperty(Nullstack,"hydrated",!1),_defineProperty(Nullstack,"initializer",null),_defineProperty(Nullstack,"instances",{}),_defineProperty(Nullstack,"instancesMountedQueue",[]),_defineProperty(Nullstack,"instancesRenewedQueue",[]),_defineProperty(Nullstack,"virtualDom",{}),_defineProperty(Nullstack,"selector",null),_defineProperty(Nullstack,"routes",{}),_defineProperty(Nullstack,"params",{}),_defineProperty(Nullstack,"renderQueue",null);var h=Nullstack;i(1);function Application_defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Application_Application extends h{constructor(...t){super(...t),Application_defineProperty(this,"room",""),Application_defineProperty(this,"command",""),Application_defineProperty(this,"socket",null),Application_defineProperty(this,"shortcuts",[]),Application_defineProperty(this,"executing",!1)}initiate({environment:t,page:e}){e.title="Ditto Server",t.client&&(this.connect(),localStorage.shortcuts&&(this.shortcuts=JSON.parse(localStorage.shortcuts)))}connect(){this.socket=new WebSocket("wss://"+location.host,"protocolOne"),this.socket.onclose=()=>setTimeout(this.connect,1e3),this.socket.onerror=()=>this.socket.close()}remove({shortcut:t}){this.shortcuts=this.shortcuts.filter(e=>e!=t),localStorage.shortcuts=JSON.stringify(this.shortcuts)}execute({shortcut:t}){if(!this.executing){if(!t){if(!this.room||!this.command)return;t=this.room+" "+this.command}this.socket.send(t),this.shortcuts.includes(t)||(this.shortcuts.push(t),localStorage.shortcuts=JSON.stringify(this.shortcuts)),this.room="",this.command="",this.executing=!0,setTimeout(()=>this.executing=!1,500)}}renderShortcut({shortcut:t}){return h.element("div",{class:"xsb x12 m2b bgm1 bgd p4x p2y"},h.element("div",{class:"yy"}," ",t," "),h.element("div",{class:"yy"},h.element("button",{class:"cm1 bgi2 p2x p1y m1r",onclick:this.remove,shortcut:t,disabled:this.executing}," x "),h.element("button",{class:"cm1 bgi1 p2x p1y m1r",onclick:this.execute,shortcut:t,disabled:this.executing}," Execute ")))}render({page:t}){const e=this.renderShortcut;return h.element("main",{class:"x12 yy y12 yvh bgm1 bgd"},h.element("div",{class:"x xx p4x"},h.element("form",{class:"x12 bgm1 md+x6 s1",onsubmit:this.execute},h.element("h1",{class:"xx p3y bcm1b bcdb ci1"}," ",t.title," "),h.element("div",{class:"xx p4"},h.element("input",{bind:"room",placeholder:"room",class:"x12 bcm1 bcd p4 m2b"}),h.element("input",{bind:"command",placeholder:"command",class:"x12 bcm1 bcd p4 m2b"}),h.element("button",{class:"x12 xx bgi1 cm1 p4",disabled:this.executing}," Execute ")),this.shortcuts.length>0&&h.element("div",{class:"x12 p4x p4t p2b bcm1t bcdt"},this.shortcuts.map(t=>h.element(e,{shortcut:t}))))))}}Application_defineProperty(Application_Application,"start",!0);var p=Application_Application;Application_Application.hash="ceaf8ed409a76b068f17fb7065c79183",h.start(p)}]);